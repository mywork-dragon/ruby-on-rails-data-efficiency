<div id="newsfeedPage" data-ng-controller="NewsfeedCtrl as newsfeedCtrl">
  <div id="wrap_spinner" ng-if="!initialPageLoadComplete">
    <div class="loading outer">
      <div class="loading inner"></div>
    </div>
  </div>

  <div ng-if="initialPageLoadComplete">
    <div class="row newsfeedPageRow" infinite-scroll="loadMoreBatches()" infinite-scroll-container="'#content'" infinite-scroll-distance="1" infinite-scroll-parent="true">
      <h4 class="empty-message" ng-hide="newsfeedCtrl.weeks.length">
        You are not following any apps or SDKs. Follow some to see your newsfeed!
      </h4>
      <button type="submit" class="btn btn-default" ng-show="newsfeedCtrl.weeks.length" data-toggle="modal" data-target="#followingModal">Following {{following.length}}</button>
      <div ng-repeat="week in newsfeedCtrl.weeks" >
        <h4 class="week">{{week.label}}</h4>
        <div data-ng-repeat="platform in week.platforms">
          <div class="platform">
            <span class="icon fa" ng-class="platform.platform == 'ios' ? 'fa-apple' : 'fa-android'"></span>
            <span>{{platform.platform == 'ios' ? 'iOS' : 'Android'}}</span>
          </div>
          <div data-ng-repeat="batch in platform.batches" class="panel panel-default">
          <div class="panel-heading" ng-click="isCollapsed = !isCollapsed; loadBatch(batch.id, batch, 1, batch.pageSize)">
            <strong ng-if="batch.owner.type == 'IosApp' || batch.owner.type == 'AndroidApp'">
              <a href="#/app/{{batch.owner.platform}}/{{batch.owner.id}}" target="_blank">
                <img ng-src="{{batch.owner.icon}}" ng-show="batch.owner.icon">
                {{batch.owner.name}}
              </a>
              <span ng-if="batch.activity_type == 'install'">
                - {{batch.activities_count}} new {{batch.activities_count == 1 ? 'SDK' : 'SDKs'}} <span class="{{batch.activity_type}}">{{batch.activities_count == 1 ? 'was' : 'were'}} seen</span>
              </span>
              <span ng-if="batch.activity_type == 'uninstall'">
                - {{batch.activities_count}} {{batch.activities_count == 1 ? 'SDK' : 'SDKs'}} <span class="{{batch.activity_type}}">removed</span>
              </span>
            </strong>
            <strong ng-if="batch.owner.type == 'IosSdk' || batch.owner.type == 'AndroidSdk'">
              <a href="#/sdk/{{batch.owner.platform}}/{{batch.owner.id}}" target="_blank">
                <img ng-src="{{batch.owner.icon}}" ng-show="batch.owner.icon">
                {{batch.owner.name}}
              </a>
              <span ng-if="batch.activity_type == 'install'">
                - <span class="{{batch.activity_type}}">seen for the first time</span> in {{batch.activities_count}} {{batch.activities_count == 1 ? 'app' : 'apps'}}
              </span>
              <span ng-if="batch.activity_type == 'uninstall'">
                - <span class="{{batch.activity_type}}">removed</span> from {{batch.activities_count}} {{batch.activities_count == 1 ? 'app' : 'apps'}}
              </span>
            </strong>
            <strong ng-if="batch.owner.type == 'AdPlatform'">
              <img ng-src="{{batch.owner.icon}}" ng-show="batch.owner.icon">
              {{batch.owner.platform}} Ads
              <span>
                - <span class="{{batch.activity_type}}">spotted {{batch.activities_count}} {{batch.activities_count == 1 ? 'ad' : 'ads'}}</span> this week
              </span>
            </strong>
          </div>
          <div class="panel-body feed-body {{batch.activity_type}}" uib-collapse="isCollapsed">
            <div class="media">
              <div class="media-body" ng-if="batch.owner.type == 'AdPlatform'">
                <div class='ad' data-ng-repeat="activity in batch.activities">
                  <a href="#/app/{{activity.other_owner.app.platform}}/{{activity.other_owner.app.id}}" target="_blank" ng-click="clickedTimelineItem(activity.other_owner.app.type, activity.other_owner.app.id, batch.activity_type, activity.other_owner.app.name, activity.other_owner.app.platform)">
                    <img class="creative" ng-src="{{activity.other_owner.ad_image}}">
                  </a>
                  <a href="#/app/{{activity.other_owner.app.platform}}/{{activity.other_owner.app.id}}" target="_blank" ng-click="clickedTimelineItem(activity.other_owner.app.type, activity.other_owner.app.id, batch.activity_type, activity.other_owner.app.name, activity.other_owner.app.platform)">
                    <img class="icon" ng-src="{{activity.other_owner.app.icon}}" ng-show="activity.other_owner.app.icon">
                    {{activity.other_owner.app.name}}
                  </a>
                  - {{calculateDaysAgo(activity.happened_at)}}
                </div>
              </div>
              <div class="media-body" ng-if="batch.owner.type == 'IosSdk' || batch.owner.type == 'AndroidSdk'">
                <table class="table table-striped table-responsive">
                  <thead>
                  <tr>
                    <th><div class="th normal-right-padding">
                      App Name
                    </div></th>
                    <th><div class="th normal-right-padding">
                      Publisher
                    </div></th>
                    <th><div class="th normal-right-padding">
                      Mobile Priority
                    </div></th>
                    <th><div class="th normal-right-padding">
                      Ad Spend
                    </div></th>
                    <th><div class="th normal-right-padding">
                      User Base Size
                    </div></th>
                  </tr>
                  </thead>

                  <tbody>
                  <tr data-ng-repeat="activity in batch.activities">
                    <td class="resultsTableAppIcon">
                        <span>
                          <a ng-href="{{(activity.other_owner.type == 'IosSdk' || activity.other_owner.type == 'AndroidSdk') ? '#/sdk/' + activity.other_owner.platform + '/' + activity.other_owner.id : '#/app/' + activity.other_owner.platform + '/' + activity.other_owner.id}}" target="_blank" ng-click="clickedTimelineItem(activity.other_owner.type, activity.other_owner.id, batch.activity_type, activity.other_owner.name, activity.other_owner.platform)">
                            <img ng-src="{{activity.other_owner.icon}}" ng-show="activity.other_owner.icon">
                            {{activity.other_owner.name}}
                          </a>
                        </span>
                        <span class="badge badge-primary" ng-if="0 <= activity.other_owner.releasedDays && activity.other_owner.releasedDays <= 15">New</span>
                    </td>
                    <td ng-if="activity.other_owner.publisher.name"><a href="#/publisher/{{activity.other_owner.platform}}/{{activity.other_owner.publisher.id}}" target="_blank">{{activity.other_owner.publisher.name}}</a></td>
                    <td class="dashboardMobilePriorityView">
                      <span ng-if="activity.other_owner.mobilePriority"><i class="fa fa-circle" ng-class="'status-' + activity.other_owner.mobilePriority"></i>{{activity.other_owner.mobilePriority | capitalize}}</span>
                    </td>
                    <td class="dashboardAdSpendView">
                      <span ng-if="!isNaN(activity.other_owner.adSpend)">
                        <i class="fa fa-circle" ng-class="'status-' + activity.other_owner.adSpend"></i>{{activity.other_owner.adSpend ? 'Yes' : 'No'}}
                      </span>
                    </td>
                    <td>{{activity.other_owner.userBase | capitalize}}</td>
                  </tr>
                  </tbody>
                </table>
              </div>
              <div class="media-body" ng-if="batch.owner.type == 'IosApp' || batch.owner.type == 'AndroidApp'">
                <div class="row">
                  <div class="col-md-6">
                    <ul ng-show="batch.activities">
                      <li ng-repeat="activity in batch.activities.slice(0, 10)">
                        <a ng-href="{{(activity.other_owner.type == 'IosSdk' || activity.other_owner.type == 'AndroidSdk') ? '#/sdk/' + activity.other_owner.platform + '/' + activity.other_owner.id : '#/app/' + activity.other_owner.platform + '/' + activity.other_owner.id}}" target="_blank" ng-click="clickedTimelineItem(activity.other_owner.type, activity.other_owner.id, batch.activity_type, activity.other_owner.name, activity.other_owner.platform)">
                          <img ng-src="{{activity.other_owner.icon}}" ng-show="activity.other_owner.icon">
                          {{activity.other_owner.name}}
                        </a>
                         - {{calculateDaysAgo(activity.happened_at)}}
                      </li>
                    </ul>
                  </div>
                  <div class="col-md-6">
                    <ul ng-show="batch.activities">
                      <li ng-repeat="activity in batch.activities.slice(10,21)">
                        <a ng-href="{{(activity.other_owner.type == 'IosSdk' || activity.other_owner.type == 'AndroidSdk') ? '#/sdk/' + activity.other_owner.platform + '/' + activity.other_owner.id : '#/app/' + activity.other_owner.platform + '/' + activity.other_owner.id}}" target="_blank" ng-click="clickedTimelineItem(activity.other_owner.type, activity.other_owner.id, batch.activity_type, activity.other_owner.name, activity.other_owner.platform)">
                          <img ng-src="{{activity.other_owner.icon}}" ng-show="activity.other_owner.icon">
                          {{activity.other_owner.name}}
                        </a>
                         - {{calculateDaysAgo(activity.happened_at)}}
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
              <div class="row" ng-if="batch.activities_count > batch.pageSize">
                <div class="col-md-6">
                </div>
                <div class="col-md-6 text-right pagination-container">
                  <uib-pagination class="pagination-sm"
                              ng-model="batch.currentPage"
                              total-items="batch.activities_count"
                              max-size="8"
                              ng-change="loadBatch(batch.id, batch, batch.currentPage, batch.pageSize)"
                              items-per-page="batch.pageSize"
                              rotate="false"
                              boundary-links="true"></uib-pagination>

                </div>
              </div>
            </div>
          </div>
         </div> 
        </div>
      </div>
    </div>
  </div>
  
  <div class="modal fade" id="followingModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h3 class="modal-title" id="myModalLabel">Following</h3>
      </div>
      <div class="modal-body">
        <ul class="following">
          <li ng-repeat="follow in following">
            <a ng-if="follow.type == 'IosSdk' || follow.type == 'AndroidSdk'" href="#/sdk/{{follow.type == 'IosSdk' ? 'ios' : 'android'}}/{{follow.id}}" target="_blank">
              <img ng-src="{{follow.icon}}" ng-show="follow.icon">
              {{follow.name}} - SDK
            </a>
            <a ng-if="follow.type == 'IosApp' || follow.type == 'AndroidApp'" href="#/app/{{follow.type == 'IosApp' ? 'ios' : 'android'}}/{{follow.id}}" target="_blank">
              <img ng-src="{{follow.icon}}" ng-show="follow.icon">
              {{follow.name}} - App
            </a>
            <div id="followButton">
              <button type="submit" class="btn btn-primary btn-block" ng-click="newFollow(follow.id, follow.type, follow.name, follow)" ng-if="!follow.following">Follow</button>
              <button type="submit" class="btn btn-danger btn-block" ng-click="newFollow(follow.id, follow.type, follow.name, follow)" ng-if="follow.following">Unfollow</button>
            </div>
          </li>
      </div>
    </div>
  </div>
</div>
  <div ng-controller="ListCtrl">
    <!-- Modals -->
    <aside ng-include="'/app/app/views/modals/list-create.html'"></aside>
    <aside ng-include="'/app/app/views/modals/list-delete.html'"></aside>
    <aside ng-include="'/app/app/views/modals/list-delete-selected.html'"></aside>

  </div>

</div>

